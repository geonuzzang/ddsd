=<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ë°©íƒˆì¶œ: ìš°ë¦¬ë‚˜ë¼ì˜ ë¯¼ì£¼í™” ì—­ì‚¬</title>
    
    <style>
        /* --- ê¸°ë³¸ & ê²Œì„ ë ˆì´ì•„ì›ƒ --- */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; background-color: #000; }
        #game-wrapper { position: relative; width: 1280px; height: 720px; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .stage { position: absolute; width: 100%; height: 100%; }
        .background-image { width: 100%; height: 100%; }
        .clickable-object { position: absolute; cursor: pointer; /* border: 2px solid red; */ }
        .hidden { display: none !important; }

        /* --- 1ë‹¨ê³„ ì˜¤ë¸Œì íŠ¸ ìœ„ì¹˜ --- */
        #s1-moon { top: 50px; left: 100px; width: 300px; height: 300px; border-radius: 50%; }
        #s1-rabbit { top: 500px; left: 700px; width: 150px; height: 180px; }
        #s1-tree { top: 150px; left: 950px; width: 300px; height: 500px; }

        /* --- 2ë‹¨ê³„ ì˜¤ë¸Œì íŠ¸ ìœ„ì¹˜ --- */
        #s2-star { top: 100px; left: 1050px; width: 150px; height: 150px; border-radius: 50%; }
        #s2-spaceship { top: 450px; left: 100px; width: 300px; height: 200px; }
        #s2-planet { top: 400px; left: 800px; width: 250px; height: 250px; }
        #s2-sun { top: 50px; left: 450px; width: 250px; height: 250px; }

        /* --- ì¸ë²¤í† ë¦¬ & ëª¨ë‹¬ --- */
        #inventory { position: absolute; bottom: 20px; left: 20px; background-color: rgba(0, 0, 0, 0.7); color: white; padding: 15px 20px; border-radius: 10px; border: 2px solid #fff; z-index: 50; }
        #inventory h3 { margin-top: 0; }
        #hint-list { list-style: none; padding-left: 0; margin-bottom: 0;}
        .modal-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: #fff; padding: 30px; border-radius: 15px; text-align: center; min-width: 500px; max-width: 90%; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-close-btn, .action-btn { margin: 10px 5px; padding: 10px 20px; font-size: 1em; cursor: pointer; border-radius: 8px; border: 1px solid #ccc; }
        .action-btn { background-color: #4CAF50; color: white; border-color: #4CAF50; }
        .action-btn.disabled { background-color: #ccc; cursor: not-allowed; }

        /* --- ë¯¸ë‹ˆê²Œì„ ìŠ¤íƒ€ì¼ --- */
        .game-canvas { position: relative; width: 500px; height: 400px; background: #2c3e50; border: 2px solid white; margin: 10px auto; overflow: hidden; }
        .player { position: absolute; width: 40px; height: 40px; background-color: #f1c40f; bottom: 10px; transition: left 0.1s linear; border-radius: 50%; }
        .obstacle { position: absolute; width: 30px; height: 30px; background-color: #c0392b; }
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 400px; margin: 20px auto; }
        .memory-card { width: 90px; height: 90px; background-color: #3498db; border-radius: 5px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 1.5em; font-weight: bold; color: white; transform-style: preserve-3d; transition: transform 0.5s; }
        .memory-card .card-face { position: absolute; backface-visibility: hidden; }
        .memory-card .card-back { transform: rotateY(180deg); }
        .memory-card.is-flipped { transform: rotateY(180deg); }
        .memory-card.is-matched { background-color: #2ecc71; }

        /* --- ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ê°•ì¡° íš¨ê³¼ --- */
        .event-highlight { animation: highlight-anim 0.7s; }
        @keyframes highlight-anim {
            0% { box-shadow: 0 0 0 0 rgba(255, 224, 102, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 224, 102, 0.3); }
            100% { box-shadow: 0 0 0 0 rgba(255, 224, 102, 0); }
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <!-- 1ë‹¨ê³„ HTML -->
        <div id="stage-1" class="stage">
            <img src="https://i.ibb.co/PGKLZTJW/Whisk-storyboard50993ead7da643a8810cfbc7.jpg" class="background-image">
            <div id="s1-moon" class="clickable-object"></div>
            <div id="s1-rabbit" class="clickable-object"></div>
            <div id="s1-tree" class="clickable-object"></div>
        </div>

        <!-- 2ë‹¨ê³„ HTML -->
        <div id="stage-2" class="stage hidden">
            <img src="https://i.ibb.co/twrLJb1b/Whisk-39cbac3b2d.jpg" class="background-image">
            <div id="s2-star" class="clickable-object"></div>
            <div id="s2-spaceship" class="clickable-object"></div>
            <div id="s2-planet" class="clickable-object"></div>
            <div id="s2-sun" class="clickable-object"></div>
        </div>
        
        <!-- ê³µí†µ UI -->
        <div id="inventory"><h3>ğŸ“œ íšë“í•œ ë‹¨ì„œ</h3><ul id="hint-list"></ul></div>
    </div>

    <!-- ëª¨ë‹¬ HTML -->
    <div id="action-modal" class="modal-wrapper hidden"><div class="modal-content"><h2 id="action-title"></h2><p id="action-desc"></p><div id="action-buttons"></div><button class="modal-close-btn">ê·¸ë§Œë‘ê¸°</button></div></div>
    <div id="puzzle-modal" class="modal-wrapper hidden"><div class="modal-content"><div id="puzzle-container"></div><button class="modal-close-btn">ë‹«ê¸°</button></div></div>
    <div id="password-modal" class="modal-wrapper hidden"><div class="modal-content"><h2 id="password-title"></h2><input type="text" id="password-input" placeholder="ë¹„ë°€ë²ˆí˜¸"><button id="password-submit-btn">í™•ì¸</button></div></div>
    <div id="clear-modal" class="modal-wrapper hidden"><div class="modal-content"><h2>ëª¨ë“  ì—­ì‚¬ì˜ ì—¬ì •ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤!</h2><p>ìš°ë¦¬ê°€ ëˆ„ë¦¬ëŠ” ììœ ëŠ” ê²°ì½” ì‰½ê²Œ ì–»ì–´ì§„ ê²ƒì´ ì•„ë‹˜ì„ ê¸°ì–µí•©ë‹ˆë‹¤.</p><button onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button></div></div>

    <!-- ê²Œì„ ì‹œì‘ ì „ ì •ë³´ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="start-modal" class="modal-wrapper"><div class="modal-content">
        <h2>ë°©íƒˆì¶œ ê²Œì„ ì‹œì‘</h2>
        <form id="user-info-form">
            <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„" required style="margin-bottom:10px;width:80%"><br>
            <input type="text" id="grade" placeholder="í•™ë…„" required style="margin-bottom:10px;width:80%"><br>
            <input type="text" id="class" placeholder="ë°˜" required style="margin-bottom:10px;width:80%"><br>
            <input type="text" id="realname" placeholder="ì´ë¦„" required style="margin-bottom:10px;width:80%"><br>
            <button type="submit" class="action-btn">ê²Œì„ ì‹œì‘</button>
        </form>
    </div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ê²Œì„ ìƒíƒœ ê´€ë¦¬ ---
        const gameState = {
            currentStage: 1,
            passwords: { 1: "23", 2: "419" },
            minigameCleared: { 1: false, 2: false },
            solvedPuzzles: new Set(),
            user: {}
        };

        // --- DOM ìš”ì†Œ ---
        const stages = { 1: document.getElementById('stage-1'), 2: document.getElementById('stage-2') };
        const modals = { action: document.getElementById('action-modal'), puzzle: document.getElementById('puzzle-modal'), password: document.getElementById('password-modal'), clear: document.getElementById('clear-modal') };
        const puzzleContainer = document.getElementById('puzzle-container');
        const hintList = document.getElementById('hint-list');
        const passwordInput = document.getElementById('password-input');

        // --- ê³µí†µ í•¨ìˆ˜ ---
        const addHint = (text, puzzleId) => {
            if (gameState.solvedPuzzles.has(puzzleId)) { alert('ì´ë¯¸ í™•ì¸í•œ ë‚´ìš©ì…ë‹ˆë‹¤.'); return false; }
            gameState.solvedPuzzles.add(puzzleId);
            const li = document.createElement('li');
            li.textContent = `âœ”ï¸ ${text}`;
            hintList.appendChild(li);
            return true;
        };

        const showActionModal = (title, desc, buttons) => {
            document.getElementById('action-title').textContent = title;
            document.getElementById('action-desc').textContent = desc;
            const buttonsContainer = document.getElementById('action-buttons');
            buttonsContainer.innerHTML = '';
            buttons.forEach(btnInfo => {
                const button = document.createElement('button');
                button.textContent = btnInfo.text;
                button.className = 'action-btn';
                button.onclick = btnInfo.onClick;
                if (btnInfo.disabled) {
                    button.classList.add('disabled');
                    button.onclick = () => alert(btnInfo.disabledMessage || 'ì•„ì§ì€ í•  ìˆ˜ ì—†ë‹¤.');
                }
                buttonsContainer.appendChild(button);
            });
            modals.action.classList.remove('hidden');
        };
        
        const showPasswordModal = (stageNum) => {
            passwordInput.value = "";
            const title = stageNum === 1 ? "ë‹¬ì—ê²Œ ì†ì‚­ì¸ë‹¤..." : "ìš°ì£¼ì„ ì— ì•”í˜¸ë¥¼ ì…ë ¥í•œë‹¤...";
            document.getElementById('password-title').textContent = title;
            modals.password.classList.remove('hidden');
        };

        const advanceToNextStage = () => {
            stages[gameState.currentStage].classList.add('hidden');
            gameState.currentStage++;
            if (stages[gameState.currentStage]) {
                stages[gameState.currentStage].classList.remove('hidden');
                alert(`ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤: ${gameState.currentStage}ë‹¨ê³„`);
                hintList.innerHTML = ''; 
                gameState.solvedPuzzles.clear();
            } else {
                modals.clear.classList.remove('hidden');
            }
        };

        document.getElementById('password-submit-btn').addEventListener('click', () => {
            const correctPassword = gameState.passwords[gameState.currentStage];
            if (passwordInput.value === correctPassword) {
                modals.password.classList.add('hidden');
                advanceToNextStage();
            } else {
                alert('ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        });

        document.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', (e) => e.target.closest('.modal-wrapper').classList.add('hidden'));
        });

        // --- 1ë‹¨ê³„ í•¨ìˆ˜ ---
        const setupStage1 = () => {
            const showTreePuzzle = () => {
                if (gameState.solvedPuzzles.has('s1-tree')) { alert('ì´ë¯¸ í•´ê²°í•œ ë¬¸ì œì…ë‹ˆë‹¤.'); return; }
                modals.action.classList.add('hidden');
                puzzleContainer.innerHTML = `<h2>ì˜¤ë˜ëœ ë‚˜ë¬´ì˜ ê¸°ì–µ</h2><p>"1987ë…„ 6ì›” í•­ìŸ ë‹¹ì‹œ, ì‹œìœ„ ì¤‘ ìµœë£¨íƒ„ì„ ë§ê³  ìˆ¨ì§„ í•™ìƒì€ 'ì´í•œì—´' ì—´ì‚¬ì´ë‹¤. ê·¸ì˜ ì„±ì”¨ì¸ 'ì´'ëŠ” ìˆ«ì Oê³¼ ì†Œë¦¬ê°€ ê°™ë‹¤."</p><input type="text" id="s1-q1" placeholder="ìˆ«ì 1ê°œ" maxlength="1"><button id="s1-q1-btn">í™•ì¸</button>`;
                modals.puzzle.classList.remove('hidden');
                document.getElementById('s1-q1-btn').onclick = () => {
                    if (document.getElementById('s1-q1').value === '2') {
                        if (addHint("1ë‹¨ê³„ ì²« ë²ˆì§¸ ìˆ«ì: 2", 's1-tree')) {
                            alert('ì •ë‹µ! ë‚˜ë¬´ê°€ ìˆ«ì "2" ëª¨ì–‘ì˜ ë‚˜ë­‡ìì„ ë–¨ì–´ëœ¨ë ¸ë‹¤.');
                            modals.puzzle.classList.add('hidden');
                        }
                    } else { alert('ì•„ë‹Œ ê²ƒ ê°™ë‹¤. ì´ë¦„ì„ ë‹¤ì‹œ í•œë²ˆ ìƒê°í•´ë³´ì.'); }
                };
            };
            const showRabbitPuzzle = () => {
                if (gameState.solvedPuzzles.has('s1-rabbit')) { alert('ì´ë¯¸ í•´ê²°í•œ ë¬¸ì œì…ë‹ˆë‹¤.'); return; }
                modals.action.classList.add('hidden');
                puzzleContainer.innerHTML = `<h2>í† ë¼ì˜ ìˆ˜ìˆ˜ê»˜ë¼</h2><p>"3.15 ë¶€ì •ì„ ê±°ì— í•­ê±°í•˜ì—¬ ì¼ì–´ë‚œ í˜ëª…ì€ 4.19 í˜ëª…ì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ 4 ë¹¼ê¸° 1ì€?"</p><input type="text" id="s1-q2" placeholder="ìˆ«ì 1ê°œ" maxlength="1"><button id="s1-q2-btn">í™•ì¸</button>`;
                modals.puzzle.classList.remove('hidden');
                document.getElementById('s1-q2-btn').onclick = () => {
                    if (document.getElementById('s1-q2').value === '3') {
                        if (addHint("1ë‹¨ê³„ ë‘ ë²ˆì§¸ ìˆ«ì: 3", 's1-rabbit')) {
                            alert('ì •ë‹µ! í† ë¼ê°€ ë‹¹ê·¼ìœ¼ë¡œ ìˆ«ì "3"ì„ ë§Œë“¤ì–´ ë³´ì—¬ì¤€ë‹¤.');
                            modals.puzzle.classList.add('hidden');
                        }
                    } else { alert('í‹€ë ¸ë‹¤. ì•„ì£¼ ê°„ë‹¨í•œ ë¬¸ì œì¸ë°...'); }
                };
            };
            const startDodgingGame = () => {
                if (gameState.minigameCleared[1]) { alert('ì´ë¯¸ ë‹¬ì˜ ì‹œí—˜ì„ í†µê³¼í–ˆë‹¤.'); return; }
                modals.action.classList.add('hidden');
                puzzleContainer.innerHTML = `<h2>ê³„ì—„êµ° í”¼í•˜ê¸°</h2><p>í‚¤ë³´ë“œ ì¢Œìš° ë°©í–¥í‚¤ë¡œ 10ì´ˆê°„ ì¥ì• ë¬¼ì„ í”¼í•˜ì„¸ìš”!</p><div class="game-canvas" id="game-canvas"><div class="player" id="player"></div></div><h3 id="game-timer">10</h3>`;
                modals.puzzle.classList.remove('hidden');
                
                const canvas = document.getElementById('game-canvas'), player = document.getElementById('player'), timerDisplay = document.getElementById('game-timer');
                let playerPos = 230; player.style.left = playerPos + 'px';
                let gameInterval, obstacleInterval, keydownListener;
                let timeLeft = 10;
                
                const movePlayer = (e) => {
                    if (e.key === 'ArrowLeft') playerPos = Math.max(0, playerPos - 20);
                    if (e.key === 'ArrowRight') playerPos = Math.min(460, playerPos + 20);
                    player.style.left = playerPos + 'px';
                };
                keydownListener = movePlayer; document.addEventListener('keydown', keydownListener);
                
                const createObstacle = () => {
                    const obstacle = document.createElement('div');
                    obstacle.className = 'obstacle';
                    obstacle.style.left = Math.random() * 470 + 'px';
                    obstacle.style.top = '-30px';
                    canvas.appendChild(obstacle);
                    let obstaclePos = -30;
                    const fall = setInterval(() => {
                        if (obstaclePos > 400) { clearInterval(fall); if(obstacle.parentNode) obstacle.remove(); } 
                        else {
                            obstaclePos += 10; obstacle.style.top = obstaclePos + 'px';
                            const pRect = player.getBoundingClientRect(), oRect = obstacle.getBoundingClientRect();
                            if (pRect.left < oRect.right && pRect.right > oRect.left && pRect.top < oRect.bottom && pRect.bottom > oRect.top) endGame(false);
                        }
                    }, 50);
                };
                
                const endGame = (isWin) => {
                    clearInterval(gameInterval); clearInterval(obstacleInterval);
                    document.removeEventListener('keydown', keydownListener);
                    if (isWin) {
                        alert('ì„±ê³µ! ì´ì œ ë‹¬ì—ê²Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.');
                        gameState.minigameCleared[1] = true;
                        addHint("íŒíŠ¸: ë‹¬ì˜ ì‹œí—˜ì„ í†µê³¼í–ˆë‹¤.", 's1-moon-game');
                    } else { alert('ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.'); }
                    modals.puzzle.classList.add('hidden');
                };
                
                gameInterval = setInterval(() => { if (--timeLeft <= 0) endGame(true); timerDisplay.textContent = timeLeft; }, 1000);
                obstacleInterval = setInterval(createObstacle, 400);
            };

            document.getElementById('s1-tree').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('ì˜¤ë˜ëœ ë‚˜ë¬´', 'ìˆ˜ë§ì€ ì—­ì‚¬ë¥¼ ì§€ì¼œë³¸ ë“¯í•˜ë‹¤.', [{ text: 'ë‚˜ë¬´ê»ì§ˆ ì‚´í´ë³´ê¸°', onClick: showTreePuzzle }]);
            });
            document.getElementById('s1-rabbit').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('í•˜ì–€ í† ë¼', 'ë‹¬ì„ ë³´ë©° ë¬´ì–¸ê°€ ë§í•˜ê³  ì‹¶ì–´í•˜ëŠ” ê²ƒ ê°™ë‹¤.', [{ text: 'í† ë¼ì—ê²Œ ë§ ê±¸ê¸°', onClick: showRabbitPuzzle }]);
            });
            document.getElementById('s1-moon').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('ë°¤í•˜ëŠ˜ì˜ ë‹¬', 'ì–´ë‘ìš´ ë°¤ì„ ë°ê²Œ ë¹„ì¶”ê³  ìˆë‹¤. íŠ¹ë³„í•œ í˜ì´ ëŠê»´ì§„ë‹¤.', [
                    { text: 'ë‹¬ì˜ í˜ ë¹Œë¦¬ê¸°', onClick: startDodgingGame },
                    { text: 'ë¹„ë°€ë²ˆí˜¸ ì†ì‚­ì´ê¸°', onClick: () => { modals.action.classList.add('hidden'); showPasswordModal(1); }, disabled: !gameState.minigameCleared[1], disabledMessage: 'ë‹¬ì˜ ì‹œí—˜ì„ ë¨¼ì € í†µê³¼í•´ì•¼ í•œë‹¤.' }
                ]);
            });
        };

        // --- 2ë‹¨ê³„ í•¨ìˆ˜ ---
        const setupStage2 = () => {
            const showPlanetPuzzle = () => {
                if (gameState.solvedPuzzles.has('s2-planet')) { alert('ì´ë¯¸ í•´ê²°í•œ ë¬¸ì œì…ë‹ˆë‹¤.'); return; }
                modals.action.classList.add('hidden');
                puzzleContainer.innerHTML = `<h2>í‘¸ë¥¸ í–‰ì„±ì˜ ë©”ì‹œì§€</h2><p>"3.15 ë¶€ì •ì„ ê±°ì— í•­ê±°í•˜ì—¬ ì¼ì–´ë‚œ í˜ëª…ì€ O.OO í˜ëª…ì´ë‹¤."</p><input type="text" id="s2-q1" placeholder="ìˆ«ì 2ìë¦¬" maxlength="2"><button id="s2-q1-btn">í™•ì¸</button>`;
                modals.puzzle.classList.remove('hidden');
                document.getElementById('s2-q1-btn').onclick = () => {
                    if (document.getElementById('s2-q1').value === '19') {
                        if (addHint("2ë‹¨ê³„ ë§ˆì§€ë§‰ ë‘ ìë¦¬: 19", 's2-planet')) {
                            alert('ì •ë‹µ! í–‰ì„±ì´ ë°ê²Œ ë¹›ë‚˜ë©° ìˆ«ì "19"ë¥¼ ë³´ì—¬ì¤€ë‹¤.');
                            modals.puzzle.classList.add('hidden');
                        }
                    } else { alert('ì•„ë‹Œ ê²ƒ ê°™ë‹¤. ë‹¤ë¥¸ ì¤‘ìš”í•œ ë‚ ì§œê°€ ìˆì—ˆëŠ”ë°...'); }
                };
            };
            const showSunPuzzle = () => {
                if (gameState.solvedPuzzles.has('s2-sun')) { alert('ì´ë¯¸ í•´ê²°í•œ ë¬¸ì œì…ë‹ˆë‹¤.'); return; }
                modals.action.classList.add('hidden');
                puzzleContainer.innerHTML = `<h2>íƒœì–‘ì˜ ì†ì‚­ì„</h2><p>"ëŒ€í•œë¯¼êµ­ í—Œë²• ì œ1ì¡° ì œ2í•­: ëŒ€í•œë¯¼êµ­ì˜ ì£¼ê¶Œì€ êµ­ë¯¼ì—ê²Œ ìˆê³ , ëª¨ë“  ê¶Œë ¥ì€ êµ­ë¯¼ìœ¼ë¡œë¶€í„° ë‚˜ì˜¨ë‹¤. ì´ ì¡°í•­ì„ ìˆê²Œ í•œ í˜ëª…ì˜ ì‹œì‘ì€ ëª‡ ì›”ì´ì—ˆì„ê¹Œ?"</p><input type="text" id="s2-q2" placeholder="ìˆ«ì 1ê°œ" maxlength="1"><button id="s2-q2-btn">í™•ì¸</button>`;
                modals.puzzle.classList.remove('hidden');
                document.getElementById('s2-q2-btn').onclick = () => {
                    if (document.getElementById('s2-q2').value === '4') {
                        if (addHint("2ë‹¨ê³„ ì²« ë²ˆì§¸ ìˆ«ì: 4", 's2-sun')) {
                            alert('ì •ë‹µ! íƒœì–‘ì´ ë” ë°ê²Œ íƒ€ì˜¤ë¥´ë©° ìˆ«ì "4"ë¥¼ ë³´ì—¬ì¤€ë‹¤.');
                            modals.puzzle.classList.add('hidden');
                        }
                    } else { alert('ì•„ë‹Œ ê²ƒ ê°™ë‹¤. ë´„ì— ì¼ì–´ë‚œ í˜ëª…ì´ì—ˆë‹¤.'); }
                };
            };
            const startMemoryGame = () => {
                if (gameState.minigameCleared[2]) { alert('ì´ë¯¸ ë³„ì˜ ê¸°ì–µì„ ëª¨ë‘ ë˜ì°¾ì•˜ë‹¤.'); return; }
                modals.action.classList.add('hidden');
                const symbols = ['4.19', '4.19', '5.18', '5.18', '6.10', '6.10', '1987', '1987'];
                symbols.sort(() => 0.5 - Math.random());
                let gridHtml = '<h3>í©ì–´ì§„ ì—­ì‚¬ì˜ ì¡°ê°ë“¤ì„ ë§ì¶”ì„¸ìš”.</h3><div class="memory-grid">';
                symbols.forEach(symbol => { gridHtml += `<div class="memory-card" data-symbol="${symbol}"><div class="card-face card-front"></div><div class="card-face card-back">${symbol}</div></div>`; });
                gridHtml += '</div>';
                puzzleContainer.innerHTML = gridHtml;
                modals.puzzle.classList.remove('hidden');

                let flippedCards = [], matchedPairs = 0;
                document.querySelectorAll('.memory-card').forEach(card => card.addEventListener('click', () => {
                    if (flippedCards.length < 2 && !card.classList.contains('is-flipped')) {
                        card.classList.add('is-flipped');
                        flippedCards.push(card);
                        if (flippedCards.length === 2) {
                            setTimeout(() => {
                                const [card1, card2] = flippedCards;
                                if (card1.dataset.symbol === card2.dataset.symbol) {
                                    card1.classList.add('is-matched'); card2.classList.add('is-matched');
                                    if (++matchedPairs === symbols.length / 2) {
                                        alert('ì„±ê³µ! ë³„ì˜ ê¸°ì–µì„ ëª¨ë‘ ë˜ì°¾ì•˜ë‹¤.');
                                        gameState.minigameCleared[2] = true;
                                        addHint("íŒíŠ¸: ìš°ì£¼ì„ ì€ ëª¨ë“  ê¸°ì–µì„ ë˜ì°¾ì€ ìë¥¼ íƒœìš´ë‹¤.", 's2-star-game');
                                        modals.puzzle.classList.add('hidden');
                                    }
                                } else {
                                    card1.classList.remove('is-flipped'); card2.classList.remove('is-flipped');
                                }
                                flippedCards = [];
                            }, 700);
                        }
                    }
                }));
            };
            document.getElementById('s2-planet').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('í‘¸ë¥¸ í–‰ì„±', 'í‘œë©´ì— ë¬´ì–¸ê°€ ì•„ë¥¸ê±°ë¦°ë‹¤.', [{ text: 'ë©”ì‹œì§€ í™•ì¸í•˜ê¸°', onClick: showPlanetPuzzle }]);
            });
            document.getElementById('s2-sun').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('íƒ€ì˜¤ë¥´ëŠ” íƒœì–‘', 'ê±°ëŒ€í•œ ë¶ˆê½ƒì´ ë¬´ì–¸ê°€ë¥¼ ë§í•˜ëŠ” ë“¯í•˜ë‹¤.', [{ text: 'ì†ì‚­ì„ ë“£ê¸°', onClick: showSunPuzzle }]);
            });
            document.getElementById('s2-star').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('ë°ì€ ë™ê·¸ë€ ë³„', 'ë³„ ì•ˆì— ìŠíŒ ê¸°ì–µë“¤ì´ ì ë“¤ì–´ìˆë‹¤.', [{ text: 'ê¸°ì–µ ë˜ì°¾ê¸°', onClick: startMemoryGame }]);
            });
            document.getElementById('s2-spaceship').addEventListener('click', (e) => {
                e.target.classList.add('event-highlight'); setTimeout(() => e.target.classList.remove('event-highlight'), 700);
                showActionModal('ì˜¤ë˜ëœ ìš°ì£¼ì„ ', 'ë‹¤ìŒ ì¥ì†Œë¡œ ì´ë™í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.', [
                    { text: 'ì•”í˜¸ ì…ë ¥í•˜ê¸°', onClick: () => { modals.action.classList.add('hidden'); showPasswordModal(2); }, disabled: !gameState.minigameCleared[2], disabledMessage: 'ëª¨ë“  ê¸°ì–µì„ ë˜ì°¾ì•„ì•¼ ìš°ì£¼ì„ ì´ ë°˜ì‘í•  ê²ƒ ê°™ë‹¤.' }
                ]);
            });
        };

        // --- ê²Œì„ ì‹œì‘ ì „ ì •ë³´ ì…ë ¥ ì²˜ë¦¬ ---
        const startModal = document.getElementById('start-modal');
        const userInfoForm = document.getElementById('user-info-form');
        document.getElementById('game-wrapper').style.filter = 'blur(3px)';
        userInfoForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const nickname = document.getElementById('nickname').value.trim();
            if (!nickname) { alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
            gameState.user.nickname = nickname;
            startModal.classList.add('hidden');
            document.getElementById('game-wrapper').style.filter = '';
        });

        // --- ê²Œì„ ì´ˆê¸°í™” ---
        setupStage1();
        setupStage2();
    });
    </script>
</body>
</html>